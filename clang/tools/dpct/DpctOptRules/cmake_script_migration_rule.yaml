# Copyright (C) Intel Corporation
# SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
# See https://llvm.org/LICENSE.txt for license information.

# This file will be installed to folder:
# {dpct_install_folder}/extensions/opt_rules.
# The rule specified in this file can be imported with commandline option:
# --rule-file={dpct_install_folder}/extensions/opt_rules/cmake_rules/cmake_script_migration_rule.yaml
---
- Rule: rule_cmake_minimum_required
  Kind: PatternRewriter
  MatchMode: Partial
  Priority: Takeover
  In: cmake_minimum_required(${name})
  Out: cmake_minimum_required(VERSION 3.24)

- Rule: rule_project
  Kind: PatternRewriter
  MatchMode: Partial
  Priority: Takeover
  In: project(${arg0} ${value})
  Out: project(${arg0} ${value})
   set(CMAKE_CXX_FLAGS "-fsycl")
  Subrules:
    value:
      In: CUDA
      Out: ""
      MatchMode: Full
      RuleId: "remove_cuda"

- Rule: rule_find_package
  Kind: PatternRewriter
  Priority: Takeover
  In: find_package(${arg0} REQUIRED)
  Out: find_package(IntelSYCL REQUIRED)

- Rule: rule_set
  Kind: PatternRewriter
  Priority: Takeover
  In: set(${value})
  Out: set(${value})
  Subrules:
    value:
      In: ${arg}.cu
      Out: ${arg}.dp.cpp

- Rule: rule_cmake_cxx_standard
  Kind: PatternRewriter
  MatchMode: Partial
  Priority: Takeover
  In: set (CMAKE_CXX_STANDARD ${version})
  Out: set (CMAKE_CXX_STANDARD 17)

- Rule: rule_cmake_cxx_compiler
  Kind: PatternRewriter
  MatchMode: Partial
  Priority: Takeover
  In: set (CMAKE_CXX_COMPILER ${version})
  Out: set (CMAKE_CXX_COMPILER icpx)

- Rule: rule_set_property_cxx_standard
  Kind: PatternRewriter
  MatchMode: Partial
  Priority: Takeover
  In: set_target_properties(${targets} PROPERTIES CXX_STANDARD ${version})
  Out: set_target_properties(${targets} PROPERTIES CXX_STANDARD 17)

- Rule: rule_set_property_cuda_seprarable_only
  Kind: PatternRewriter
  MatchMode: Partial
  Priority: Takeover
  In: set_target_properties(${target_property} CUDA_SEPARABLE_COMPILATION ${state})
  Out: ""

- Rule: rule_set_property_cuda_seprarable
  Kind: PatternRewriter
  MatchMode: Partial
  Priority: Takeover
  In: set_target_properties(${target_property} CUDA_SEPARABLE_COMPILATION ${state} ${other_properties})
  Out: set_target_properties(${target_property} ${other_properties})

- Rule: rule_set_property_cuda_architechtures
  Kind: PatternRewriter
  MatchMode: Partial
  Priority: Takeover
  In: set_target_properties(${targets} PROPERTIES CUDA_ARCHITECHTURES ${state} ${other_properties})
  Out: set_target_properties(${targets} PROPERTIES ${other_properties})

- Rule: rule_set_property_cuda_architechtures_only
  Kind: PatternRewriter
  MatchMode: Partial
  Priority: Takeover
  In: set_target_properties(${target_property} CUDA_ARCHITECHTURES ${state})
  Out: ""

- Rule: rule_set_property_cuda_architechtures
  Kind: PatternRewriter
  MatchMode: Partial
  Priority: Takeover
  In: set_target_properties(${target_property} CUDA_ARCHITECHTURES ${state} ${other_properties})
  Out: set_target_properties(${target_property} ${other_properties})
